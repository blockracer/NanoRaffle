<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano River | Raffle</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="icon" href="rivercat.ico" type="image/x-icon">
    <link rel="shortcut icon" href="rivercat.ico" type="image/x-icon">
</head>

<body>
    <header>
        <div id="logo-container">
            <img id="logo" src="/logo.png" alt="Nano Raffle Logo">
        </div>
    </header>

    <nav>
        <a href="/entries.html">CURRENT ENTRIES</a>
        <a href="/winners.html">WINNERS</a>
    </nav>

    <main>
        <h1 id="pageTitle">NANO RAFFLE</h1>
        <hr class="divider">
	<div id="entryMessage">Ӿ1 PER ENTRY <br>(Multiple entries from a single payment enabled)</div><br><br>
        <div id="nanoAddress">
            <strong>NANO ADDRESS:</strong><br><br>
            <b>nano_38sbai751batgzspmtf4x3bky7pcd3br19upemzbtb9jafaj4pdgbpo4phr5</b>
            <button id="copyButton" onclick="copyToClipboard()"><i class="fas fa-copy"></i></button>
        </div>
        <div id="qrcodeContainer">
            <div id="qrcode" onclick="openNanoLink()"></div>
        </div>
        <div id="websocketMessages"></div>
        <div id="countdownTimer"></div><br><br>
        <hr class="divider">
    </main>

    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>

    <script>
        let a = "?r=Armour";
        const worker = new Worker('worker.js');

        // Function to update countdown timer
        function updateCountdownTimer() {
            fetch('/time.json')
                .then(response => response.json())
                .then(data => {
                    const currentTime = Math.floor(Date.now() / 1000);
                    const remainingTime = data.time - currentTime;

                    const days = Math.floor(remainingTime / 86400);
                    const hours = Math.floor((remainingTime % 86400) / 3600);
                    const minutes = Math.floor((remainingTime % 3600) / 60);
                    const seconds = remainingTime % 60;

                    const countdownTimer = document.getElementById('countdownTimer');
                    countdownTimer.textContent = `Time Remaining: ${days}d ${hours}h ${minutes}m ${seconds}s`;

                    if (remainingTime <= 0) {
                        location.reload();
                    }
                });
        }

        //text: 'nano:nano_38sbai751batgzspmtf4x3bky7pcd3br19upemzbtb9jafaj4pdgbpo4phr5?amount=1000000000000000000000000000000',
	    function displayMessage(message) {
            const websocketMessages = document.getElementById('websocketMessages');

            // Check if the pot amount is less than 0.00001
            const potAmount = parseFloat(message);
            const displayedPotAmount = (potAmount < 0.00001) ? 0 : potAmount.toFixed(5).replace(/\.?0+$/, '');

            websocketMessages.textContent = `CURRENT POT: Ӿ${displayedPotAmount}`;

            const qrcodeElement = document.getElementById('qrcode');
            qrcodeElement.innerHTML = '';

            const qrcode = new QRCode(qrcodeElement, {
                text: 'nano:nano_38sbai751batgzspmtf4x3bky7pcd3br19upemzbtb9jafaj4pdgbpo4phr5',
                width: 256,
                height: 256
            });
        }
        
        worker.onmessage = function (event) {
            const data = event.data;

            switch (data.type) {
                case 'open':
                    console.log('WebSocket connection opened');
                    break;
                case 'message':
                    displayMessage(data.data);
                    break;
                case 'close':
                    console.log('WebSocket connection closed');
                    setTimeout(() => {
                        worker.postMessage({ type: 'reconnect' });
                    }, 5000);
                    break;
                case 'checkConnection':
                    if (!data.isConnected) {
                        console.log('WebSocket connection is closed');
                        worker.postMessage({ type: 'reconnect' });
                    }
                    break;
                default:
                    break;
            }
        };

        setInterval(updateCountdownTimer, 1000);
    </script>
    <script>
	     function openNanoLink() {
            const nanoLink = 'nano:nano_38sbai751batgzspmtf4x3bky7pcd3br19upemzbtb9jafaj4pdgbpo4phr5';
            window.location.href = nanoLink;
        }
        // Function to copy Nano address to clipboard
        function copyToClipboard() {
            const nanoAddress = 'nano_38sbai751batgzspmtf4x3bky7pcd3br19upemzbtb9jafaj4pdgbpo4phr5';
            const textarea = document.createElement('textarea');
            textarea.value = nanoAddress;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            //alert('Nano address copied to clipboard!');
        }

         // Function to open Nano Cat link in a new tab
         function openNanoCatLink() {
            // Extract the image name from the src attribute
            const imageUrl = document.getElementById('nanoCatImage').src;
            const imageName = imageUrl.split('/').pop().split('.')[0];

            // Construct the link with the asset ID
            const assetId = imageName; // Use imageName directly as assetId
            const link = `https://nanswap.com/art/assets/${assetId}`;

            // Open the link in a new tab
            window.open(link, '_blank');
        }
	    function handleVisibilityChange() {
            if (document.visibilityState === 'visible') {
                console.log('Page is visible. Reconnecting WebSocket...');
                worker.postMessage({ type: 'reconnect' });
            }
        }

        document.addEventListener('visibilitychange', handleVisibilityChange);
	    
	</script>

    <div>
        <h1 id="pageTitle">EXTRA PRIZES</h1>
        <img id="nanoCatImage" src="/41jX7exYJUN.png" alt="Nyano Cat" style="max-width: 100%; width: 300px; height: auto;" onclick="openNanoCatLink()" />
        <p>The next winner will also receive this Nyano Cats NaNFT on <a href="https://nanswap.com/art?r=Armour" style="color:#2980b9" target="_blank">Nanswap Art</a>.<br><strong>IMPORTANT:</strong> Please enter this raffle with the Nano Address linked to your Nanswap account for transferring the asset.</p>
    </div>

</body>
<footer style="color: white;">Made with <span style="color: red;">❤️</span> by <a href="https://github.com/blockracer" style="color: white;">@blockracer</a></footer>

</html>

